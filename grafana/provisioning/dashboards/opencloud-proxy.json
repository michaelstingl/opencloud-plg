{
  "uid": "opencloud-proxy",
  "title": "OpenCloud Proxy - HTTP Access Logs",
  "description": "HTTP access log analysis for the OpenCloud proxy component with request metrics, error tracking, and path analysis",
  "tags": [
    "opencloud",
    "proxy",
    "http",
    "access-logs"
  ],
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 5,
  "refresh": "auto",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "templating": {
    "list": [
      {
        "name": "method",
        "label": "HTTP Method",
        "type": "custom",
        "query": "GET,POST,PUT,DELETE,PATCH,HEAD,OPTIONS,PROPFIND,PROPPATCH,MKCOL,COPY,MOVE,LOCK,UNLOCK,REPORT",
        "multi": true,
        "includeAll": true,
        "allValue": ".+",
        "current": {
          "text": "GET",
          "value": "GET"
        }
      },
      {
        "name": "status_filter",
        "label": "Status",
        "type": "custom",
        "query": "All : .+,2xx : 2..,3xx : 3..,4xx : 4..,5xx : 5..",
        "multi": false,
        "includeAll": false,
        "current": {
          "text": "All",
          "value": ".+"
        }
      },
      {
        "name": "path",
        "label": "Path (regex)",
        "type": "textbox",
        "current": {
          "selected": false,
          "text": ".*",
          "value": ".*"
        },
        "options": [
          {
            "selected": true,
            "text": ".*",
            "value": ".*"
          }
        ]
      }
    ]
  },
  "panels": [
    {
      "id": 100,
      "title": "Overview",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "collapsed": false
    },
    {
      "id": 110,
      "title": "Total Requests",
      "description": "Total HTTP requests in selected time range",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 0,
        "y": 1
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": null
              }
            ]
          },
          "unit": "short"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum(count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__range]))",
          "refId": "A"
        }
      ]
    },
    {
      "id": 120,
      "title": "Error Rate",
      "description": "Percentage of 4xx/5xx responses",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 8,
        "y": 1
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "orange",
                "value": 5
              },
              {
                "color": "red",
                "value": 10
              }
            ]
          },
          "unit": "percent"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum(count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"[45]..\" [$__range])) / sum(count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" [$__range])) * 100",
          "refId": "A"
        }
      ]
    },
    {
      "id": 130,
      "title": "Request Rate",
      "description": "Requests per second",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 16,
        "y": 1
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "reqps"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "reduceOptions": {
          "calcs": [
            "mean"
          ],
          "fields": "",
          "values": false
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum(rate({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__auto]))",
          "refId": "A"
        }
      ]
    },
    {
      "id": 200,
      "title": "Traffic Analysis",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "collapsed": false
    },
    {
      "id": 210,
      "title": "Requests Over Time by Status",
      "description": "Request volume grouped by HTTP status code",
      "type": "timeseries",
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 6
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "showPoints": "never"
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byRegexp",
              "options": "2.."
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "3.."
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "4.."
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "5.."
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "calcs": [
            "sum"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum by (status) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__auto]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 300,
      "title": "Top Lists",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 14
      },
      "collapsed": false
    },
    {
      "id": 310,
      "title": "Top 10 Paths",
      "description": "Most frequently accessed paths",
      "type": "table",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 15
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short",
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            }
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.hidden",
                "value": true
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "uri"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 350
              },
              {
                "id": "displayName",
                "value": "Path"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Requests"
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": {
          "show": false
        }
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "Value"
              }
            ]
          }
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "topk(10, sum by (uri) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | __error__=\"\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__range])))",
          "legendFormat": "",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "id": 320,
      "title": "Top 10 Client IPs",
      "description": "Most active client IP addresses",
      "type": "table",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 15
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short",
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            }
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.hidden",
                "value": true
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "remote_addr"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 200
              },
              {
                "id": "displayName",
                "value": "Client IP"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Requests"
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": {
          "show": false
        }
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "Value"
              }
            ]
          }
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "topk(10, sum by (remote_addr) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__range])))",
          "legendFormat": "",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "id": 400,
      "title": "HTTP Methods",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 23
      },
      "collapsed": false
    },
    {
      "id": 410,
      "title": "Requests by Method",
      "description": "Distribution of HTTP methods",
      "type": "piechart",
      "gridPos": {
        "h": 6,
        "w": 8,
        "x": 0,
        "y": 24
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        }
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "values": [
            "value",
            "percent"
          ]
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "sum"
          ],
          "fields": "",
          "values": false
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum by (method) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__range]))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 420,
      "title": "Method Distribution Over Time",
      "description": "HTTP methods over time",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 16,
        "x": 8,
        "y": 24
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "line",
            "fillOpacity": 20,
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "lineWidth": 2,
            "pointSize": 5,
            "showPoints": "never"
          },
          "unit": "short"
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum by (method) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\" [$__auto]))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 500,
      "title": "Error Analysis",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 30
      },
      "collapsed": false
    },
    {
      "id": 510,
      "title": "4xx Client Errors",
      "description": "Client errors (400-499) over time",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 0,
        "y": 31
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "lineWidth": 1
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byRegexp",
              "options": "40[0134]"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "orange",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "4(0[5-9]|[1-9].)"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "yellow",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "calcs": [
            "sum"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum by (status) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"4..\" [$__auto]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 520,
      "title": "5xx Server Errors",
      "description": "Server errors (500-599) over time - investigate immediately!",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 31
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "red",
            "mode": "fixed"
          },
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": {
              "mode": "normal",
              "group": "A"
            },
            "lineWidth": 1
          },
          "unit": "short"
        }
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "calcs": [
            "sum"
          ]
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "sum by (status) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"5..\" [$__auto]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ]
    },
    {
      "id": 530,
      "title": "Top Error Paths (4xx)",
      "description": "Paths with most client errors",
      "type": "table",
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 0,
        "y": 37
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 10
              },
              {
                "color": "orange",
                "value": 50
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "uri"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Value"
          }
        ]
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "Value"
              }
            ]
          }
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "topk(20, sum by (uri, status) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | status=~\"4..\" [$__range])))",
          "legendFormat": "{{uri}} ({{status}})",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "id": 540,
      "title": "Top Error Paths (5xx)",
      "description": "Paths with most server errors - high priority!",
      "type": "table",
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 37
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "orange",
                "value": 1
              },
              {
                "color": "red",
                "value": 10
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "uri"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "Value"
          }
        ]
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "desc": true,
                "field": "Value"
              }
            ]
          }
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "topk(20, sum by (uri, status) (count_over_time({service=\"opencloud\"} | json | service_extracted=\"proxy\" | status=~\"5..\" [$__range])))",
          "legendFormat": "{{uri}} ({{status}})",
          "refId": "A",
          "instant": true
        }
      ]
    },
    {
      "id": 600,
      "title": "Detailed Logs",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 43
      },
      "collapsed": false
    },
    {
      "id": 610,
      "title": "Access Logs",
      "description": "HTTP access logs from proxy component",
      "type": "logs",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 44
      },
      "datasource": {
        "type": "loki",
        "uid": "loki"
      },
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": true,
        "showCommonLabels": false,
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "loki"
          },
          "expr": "{service=\"opencloud\"} | json | service_extracted=\"proxy\" | method=~\"$method\" | uri=~\"$path\" | status=~\"$status_filter\"",
          "refId": "A"
        }
      ]
    }
  ]
}
